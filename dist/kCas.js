"use strict";function asyncGeneratorStep(e,t,n,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){asyncGeneratorStep(a,r,o,i,c,"next",e)}function c(e){asyncGeneratorStep(a,r,o,i,c,"throw",e)}i(void 0)}))}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}Object.defineProperty(exports,"__esModule",{value:!0});const kHttpClient=function(e,t,n={}){return new Promise((r,o)=>{const a=new XMLHttpRequest;let i=t,c=null;if("get"===e.toLowerCase()){const{params:e={}}=n;Object.keys(e).forEach((t,n)=>{i+=`${0===n?"?":"&"}${t}=${e[t]}`})}else c=JSON.stringify(n);a.open(e,i),a.setRequestHeader("content-type","application/json;charset=UTF-8"),"string"==typeof n&&(a.setRequestHeader("content-type","application/x-www-form-urlencoded"),c=n),a.onload=function(){if(200===this.status){const{response:e}=this;r(e&&JSON.parse(e))}else a.onerror()},a.onerror=function(){const{status:e,response:t}=this;o({status:e,response:t&&JSON.parse(t)})},a.send(c)})};function getUrlVlaueByKey(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href,n=RegExp("".concat(e,"=([^&]*)")),r=t.match(n);return r&&r[1]}function getRemoveCasKeyUrl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.url,n=void 0===t?window.location.href:t,r=e.key,o=void 0===r?"ticket|language|co(.?)ntry|variant":r,a=RegExp("[?|&]?(".concat(o,")=([^&]*)"),"g");return n.replace(a,"")}function getDeviceId(){for(var e=[],t=0;10>t;t+=1)e[t]="abcdef".substr(Math.floor(6*Math.random()),1);return e.join("")+(new Date).getTime()}kHttpClient.get=function(e,t){return kHttpClient("GET",e,t)},kHttpClient.post=function(e,t){return kHttpClient("POST",e,t)},kHttpClient.put=function(e,t){return kHttpClient("PUT",e,t)},kHttpClient.delete=function(e,t){return kHttpClient("DELETE",e,t)};var kCasUtils={getDeviceId:getDeviceId,getRemoveCasKeyUrl:getRemoveCasKeyUrl,getUrlVlaueByKey:getUrlVlaueByKey},kCas=function(){function e(t){var n=t.appKey,r=t.appSecret,o=t.authService,a=t.casService,i=t.casloginPath,c=void 0===i?"/cas/login":i,s=t.caslogoutPath,u=void 0===s?"/cas/logout":s,l=t.authTokenPath,h=void 0===l?"/gateway/check_token":l,p=t.authTicketPath,k=void 0===p?"/user/cas/knock":p,f=t.authLogoutPath,v=void 0===f?"/user/auth/logout":f,g=t.authRolesPath,y=void 0===g?"/dev-basp-user/indexModule/queryRoles":g;_classCallCheck(this,e),this.appKey=n,this.appSecret=r,this.authTokenUrl=o+h,this.authTicketUrl=o+k,this.authLogoutUrl=o+v,this.authRolesUrl=o+y,this.casloginURL=a+c,this.caslogoutURL=a+u}var t,n;return _createClass(e,[{key:"login",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function t(){var n,r,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=getRemoveCasKeyUrl(),t.next=3,this.casLogin();case 3:return r=t.sent,t.next=6,this.authRoles().catch((function(){o.authLogout(),e.removeToken(),window.location.href="".concat(o.casloginURL,"?service=").concat(n)}));case 6:return r.roles=(t.sent||{}).result,t.abrupt("return",r);case 10:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"casLogin",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function t(){var n,r,o,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=getUrlVlaueByKey("ticket"),r=getRemoveCasKeyUrl(),t.next=4,this.authCheckToken().catch((function(){n||(a.authLogout(),window.location.href="".concat(a.casloginURL,"?service=").concat(r))}));case 4:if(!(o=t.sent)){t.next=7;break}return t.abrupt("return",o);case 7:return t.next=9,this.authCheckTick(n).catch((function(){a.authLogout(),window.location.href="".concat(a.casloginURL,"?service=").concat(r)}));case 9:if(!(o=t.sent)||!o.errorMessage){t.next=12;break}return t.abrupt("return",Promise.reject(o.errorMessage));case 12:return o&&o.obj.token&&e.setToken(o.obj.token),t.abrupt("return",o);case 14:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"authRoles",value:function(){return kHttpClient.get(this.authRolesUrl)}},{key:"authCheckTick",value:function(e){var t=this.appKey,n=this.appSecret,r=this.authTicketUrl,o={ticket:e,service:getRemoveCasKeyUrl(),appKey:t,appSecret:n,deviceId:getDeviceId()};return kHttpClient.post(r,o)}},{key:"authCheckToken",value:function(){return kHttpClient.get(this.authTokenUrl)}},{key:"authLogout",value:function(){return kHttpClient.get(this.authLogoutUrl).catch((function(){e.removeToken()}))}}],[{key:"setToken",value:function(e){document.cookie="token=".concat(e)}},{key:"removeToken",value:function(){var e=document.cookie.match(/[^ =;]+(?=\=)/g);if(e)for(var t=e.length;t--;)document.cookie="".concat(e[t],"=0;expires=").concat(new Date(0).toUTCString())}}]),e}();exports.default=kCas,exports.kCas=kCas,exports.kCasUtils=kCasUtils;
